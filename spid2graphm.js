var maxH,maxW,xmlDoc,drawing,selectedElement,offset,transform,patterns,patternsDoc,xml,selectedPaths,corrector=3.775,minTolerance=10,largo=3,factor=750,parser=new DOMParser,selectSet=[],highlightedItem="",defaultPathLengthLimit=250,lengthExcededCount=0;let currentElement=null;var contextMenu=null,modal=null,propertiesTable=null,svg=document.getElementById("mysvg");let startX,startY,viewBox=[800,-0,1800,1800],isPanning=!1;var isolatedItemId="",downstreamNodeFilter="",downstreamEdgeFilter="[@Type='Piping' or @Type='DirectConnection']",upstreamNodeFilter="",upwnstreamEdgeFilter="[@Type='Piping' or @Type='DirectConnection']",isolateNodeFilter="/Data[(contains(@Subtype,'valve') and not(contains(@Subtype,'Check')) and not(contains(@Subtype,'check'))) or @Type='Nozzle']",isolateEdgeFilter="[@Type='Piping' or @Type='DirectConnection']",listOfChildNozzles="";function makeDraggable(){(svg=document.getElementById("mysvg")).addEventListener("contextmenu",rightClick,!1),svg.addEventListener("mousedown",startDrag,!1),svg.addEventListener("mousemove",drag,!1),svg.addEventListener("mouseup",endDrag,!1),svg.addEventListener("wheel",(t=>{t.preventDefault();let e=t.deltaY<0?1/1.1:1.1,n=t.clientX/window.innerWidth*viewBox[2]+viewBox[0],r=t.clientY/window.innerHeight*viewBox[3]+viewBox[1];viewBox[2]*=e,viewBox[3]*=e,viewBox[0]=n-(n-viewBox[0])*e,viewBox[1]=r-(r-viewBox[1])*e,svg.setAttribute("viewBox",viewBox.join(" "))}))}function showMetadata(t){var e=[],n=xmlDoc.getElementById(t);if(null!=n){console.clear();var r=0;for(e.push({name:"Graph element",value:n.nodeName}),r=0;r<n.attributes.length;r++)e.push({name:n.attributes[r].nodeName,value:n.attributes[r].nodeValue.replaceAll("\\","\\\\")});var l=n.childNodes[0];for(r=0;r<l.attributes.length;r++){var i=l.attributes[r].nodeValue.replaceAll("\\","\\\\");i=i.replace('"','\\"'),e.push({name:l.attributes[r].nodeName,value:i})}}return e}function rightClick(t){t.preventDefault(),highlight(highlightedItem=t.target.getAttribute("id")),currentElement=t.target;const e=t.pageX,n=t.pageY,r=contextMenu.offsetWidth,l=contextMenu.offsetHeight;contextMenu.style.left=(e+r>window.innerWidth?window.innerWidth-r:e)+"px",contextMenu.style.top=(n+l>window.innerHeight?window.innerHeight-l:n)+"px",contextMenu.classList.add("show")}function startDrag(t){0==t.button?"mysvg"==t.target.getAttribute("id")?(isPanning=!0,startX=event.clientX,startY=event.clientY,svg.style.cursor="grabbing"):(highlightedItem&&(highlight(highlightedItem),highlightedItem=""),highlight(highlightedItem=t.target.getAttribute("id")),selectSet.includes(highlightedItem)||selectSet.push(highlightedItem),(t.target.classList.contains("draggable")||t.target.classList.contains("draggable_highlighted"))&&(selectedElement=t.target)):t.button}function drag(t){if(0==t.button)if("mysvg"==t.target.getAttribute("id")){if(!isPanning)return;let t=(event.clientX-startX)*(viewBox[2]/window.innerWidth),e=(event.clientY-startY)*(viewBox[3]/window.innerHeight);viewBox[0]-=t,viewBox[1]-=e,svg.setAttribute("viewBox",viewBox.join(" ")),startX=event.clientX,startY=event.clientY}else if(selectedElement&&"info"!=selectedElement){var e=oMousePosSVG(t);selectedElement.setAttribute("cx",parseInt(e.x)/corrector+"mm"),selectedElement.setAttribute("cy",parseInt(e.y)/corrector+"mm")}}function endDrag(t){if("mysvg"==t.target.getAttribute("id"))isPanning=!1,(D=document.getElementById("mysvg")).style.cursor="grab";else if(selectedElement)if(0==t.button){var e=oMousePosSVG(t);selectedElement.setAttribute("cx",parseInt(e.x)/corrector+"mm"),selectedElement.setAttribute("cy",parseInt(e.y)/corrector+"mm");var n=null,r=null,l=null,a=null,o=xmlDoc.getElementsByTagName("Edge");for(i=0;i<o.length;i++){n=null,r=null,l=null,a=null;var s="";s="EndNode to StartNode"==o[i].getAttribute("FlowDir")?o[i].getAttribute("EndNode"):o[i].getAttribute("StartNode");var d=document.getElementById(o[i].id);s==selectedElement.id&&"OPC Pairing"!=o[i].childNodes[0].getAttribute("Type")&&null!=d&&(d.setAttribute("x1",selectedElement.getAttribute("cx")),d.setAttribute("y1",selectedElement.getAttribute("cy")),n=d.getAttribute("x1"),r=d.getAttribute("y1"),l=d.getAttribute("x2"),a=d.getAttribute("y2"));if(("EndNode to StartNode"==o[i].getAttribute("FlowDir")?o[i].getAttribute("StartNode"):o[i].getAttribute("EndNode"))==selectedElement.id&&"OPC Pairing"!=o[i].childNodes[0].getAttribute("Type")&&null!=d&&(d.setAttribute("x2",selectedElement.getAttribute("cx")),d.setAttribute("y2",selectedElement.getAttribute("cy")),n=d.getAttribute("x1"),r=d.getAttribute("y1"),l=d.getAttribute("x2"),a=d.getAttribute("y2")),null!=n&&null!=r&&null!=l&&null!=a){var u=parseFloat(n.replace("mm","")),c=parseFloat(r.replace("mm","")),m=parseFloat(l.replace("mm","")),g=parseFloat(a.replace("mm","")),h=(g-c)/(m-u),b=Math.atan(h),p=(parseFloat(u)+parseFloat(m))/2,E=(parseFloat(c)+parseFloat(g))/2,A=m-u,x=g-c,v=document.getElementById("fd1_"+d.getAttribute("id")),y=document.getElementById("fd2_"+d.getAttribute("id"));if(Math.abs(A)<minTolerance&&Math.abs(x)<minTolerance)v.setAttribute("x1",p+"mm"),v.setAttribute("y1",E+"mm"),v.setAttribute("x2",p+"mm"),v.setAttribute("y2",E+"mm"),y.setAttribute("x1",p+"mm"),y.setAttribute("y1",E+"mm"),y.setAttribute("x2",p+"mm"),y.setAttribute("y2",E+"mm");else{var f,w,N=p+largo*Math.sin(b),P=E-largo*Math.cos(b);u<=m?(f=p+2*largo*Math.cos(b),w=E+2*largo*Math.sin(b)):(f=p-2*largo*Math.cos(b),w=E-2*largo*Math.sin(b)),v.setAttribute("x1",p+"mm"),v.setAttribute("y1",E+"mm"),v.setAttribute("x2",N+"mm"),v.setAttribute("y2",P+"mm"),y.setAttribute("x1",N+"mm"),y.setAttribute("y1",P+"mm"),y.setAttribute("x2",f+"mm"),y.setAttribute("y2",w+"mm")}}}selectedElement=!1}else if(2==t.button){var D=document.getElementById("mysvg"),S=document.getElementById("info");null!=S&&D.removeChild(S),selectedElement=!1}}function GetElementsByAttribute(t,e,n){return Array.prototype.slice.call(xmlDoc.getElementsByTagName(t),0).where((function(t){return t.getAttribute(e)==n}))}function oMousePosSVG(t){var e=mysvg.createSVGPoint();e.x=t.clientX,e.y=t.clientY;var n=mysvg.getScreenCTM().inverse();return e.matrixTransform(n)}function FlowDirArrow(t,e,n,r,l,i,a){var o="";o=""==l||null==l?"FlowDirNotSetArrow":"StartNode to EndNode"==l||"EndNode to StartNode"==l?"FlowDirSetArrow":"FlowDirSetBiDirectional";var s=(r-e)/(n-t),d=Math.atan(s),u=(parseFloat(t)+parseFloat(n))/2,c=(parseFloat(e)+parseFloat(r))/2,m=n-t,g=r-e;if(Math.abs(m)<minTolerance&&Math.abs(g)<minTolerance){let t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1",u+"mm"),t.setAttribute("y1",c+"mm"),t.setAttribute("x2",u+"mm"),t.setAttribute("y2",c+"mm"),t.setAttribute("class",o),t.setAttribute("id","fd1_"+i),a.appendChild(t);let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",u+"mm"),e.setAttribute("y1",c+"mm"),e.setAttribute("x2",u+"mm"),e.setAttribute("y2",c+"mm"),e.setAttribute("class",o),e.setAttribute("id","fd2_"+i),a.appendChild(e)}else{var h,b,p=u+largo*Math.sin(d),E=c-largo*Math.cos(d);t<=n?(h=u+2*largo*Math.cos(d),b=c+2*largo*Math.sin(d)):(h=u-2*largo*Math.cos(d),b=c-2*largo*Math.sin(d));let e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",u+"mm"),e.setAttribute("y1",c+"mm"),e.setAttribute("x2",p+"mm"),e.setAttribute("y2",E+"mm"),e.setAttribute("class",o),e.setAttribute("id","fd1_"+i),a.appendChild(e);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1",p+"mm"),r.setAttribute("y1",E+"mm"),r.setAttribute("x2",h+"mm"),r.setAttribute("y2",b+"mm"),r.setAttribute("class",o),r.setAttribute("id","fd2_"+i),a.appendChild(r)}}function PaintEdge(t){t.getElementsByTagName("Data");if("OPC Pairing"!=t.getAttribute("Type")){var e="",n="";if("EndNode to StartNode"==t.getAttribute("FlowDir")?(null!=t.getAttribute("StartNode")&&(n=xmlDoc.querySelector('[*|id="'+t.getAttribute("StartNode")+'"]')),null!=t.getAttribute("EndNode")&&(e=xmlDoc.querySelector('[*|id="'+t.getAttribute("EndNode")+'"]'))):(null!=t.getAttribute("StartNode")&&(e=xmlDoc.querySelector('[*|id="'+t.getAttribute("StartNode")+'"]')),null!=t.getAttribute("EndNode")&&(n=xmlDoc.querySelector('[*|id="'+t.getAttribute("EndNode")+'"]'))),null!=e&&null!=n){var r=e.getAttribute("cx"),l=e.getAttribute("cy"),i=n.getAttribute("cx"),a=n.getAttribute("cy"),o=r.toString().replace(",","."),s=l.toString().replace(",","."),d=i.toString().replace(",","."),u=a.toString().replace(",",".");o*=factor,d*=factor,s=maxH-s*factor,u=maxH-u*factor;var c=t.parentNode.parentNode.parentNode,m=t.getAttribute("Type");let g=document.getElementById(m+"_"+c.getAttribute("Id")),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",o+"mm"),h.setAttribute("y1",s+"mm"),h.setAttribute("x2",d+"mm"),h.setAttribute("y2",u+"mm"),h.setAttribute("id",t.getAttribute("id")),h.setAttribute("class",t.getAttribute("Type")),g.appendChild(h);document.getElementById(t.getAttribute("id"));FlowDirArrow(o,s,d,u,t.getAttribute("FlowDir"),t.getAttribute("id"),g)}}}function PaintNode(t){var e=t.getElementsByTagName("Data"),n=t.getAttribute("cx"),r=t.getAttribute("cy"),l=n.toString().replace(",","."),i=r.toString().replace(",",".");l*=factor,i=maxH-i*factor;var a=2,o="",s=e[0].getAttribute("Type");switch(s){case"Instrument":o="green";break;case"Nozzle":o="red";break;case"Equipment":o="brown",a=5;break;case"Piping Component":o="yellow";break;case"OPC":o="blue";break;case"Junction":o="orange";break;case"Equipment Component":o="brown";break;default:o="grey",s="Undefined node group"}var d=t.parentNode.parentNode.parentNode;let u=document.getElementById(s+"_"+d.getAttribute("Id")),c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",l+"mm"),c.setAttribute("cy",i+"mm"),c.setAttribute("r",a+"mm"),c.setAttribute("stroke","black"),c.setAttribute("stroke-width","1"),c.setAttribute("fill",o),c.setAttribute("fill-opacity","50%"),c.setAttribute("id",t.getAttribute("id")),c.setAttribute("class","draggable"),u.appendChild(c)}function go(){xmlDoc=parser.parseFromString(xml,"text/xml"),extent=xmlDoc.getElementsByTagName("Extent");var t=xmlDoc.evaluate("//Drawings/@DrawingMatrixDimension",xmlDoc,null,XPathResult.STRING_TYPE,null).stringValue;maxW=xmlDoc.evaluate("//Drawings/@MaxDrawingWidth",xmlDoc,null,XPathResult.STRING_TYPE,null).stringValue*factor*t,maxH=xmlDoc.evaluate("//Drawings/@MaxDrawingHeight",xmlDoc,null,XPathResult.STRING_TYPE,null).stringValue*factor*t,document.getElementById("mysvg").setAttribute("width",maxW+"mm"),document.getElementById("mysvg").setAttribute("height",maxH+"mm");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width",maxW+"mm"),e.setAttribute("height",maxH+"mm"),e.setAttribute("style","fill:none;stroke-width:6;stroke:rgb(55,55,255)"),document.getElementById("mysvg").appendChild(e);var n=xmlDoc.getElementsByTagName("Node");for(i=0;i<n.length;i++)PaintNode(n[i]);var r=xmlDoc.getElementsByTagName("Edge");for(i=0;i<r.length;i++)PaintEdge(r[i]);makeDraggable(),setupContextMenu(),document.addEventListener("keydown",KeyPressed,!1)}function GetPattern(){var t=parser.parseFromString("<Pattern Name='give me a name'></Pattern>","text/xml");selectSet.forEach((function(e){var n=xmlDoc.evaluate("//*[@id='"+e+"']",xmlDoc,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),r=parser.parseFromString(n.singleNodeValue.outerHTML,"text/xml").documentElement;t.documentElement.appendChild(r)}));for(var e={},n=t.evaluate("//Node",t,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0;r<n.snapshotLength;r++){var l=(a=n.snapshotItem(r)).getAttribute("id"),i="N"+r.toString().padStart(2,0);e[l]=i,a.setAttribute("id",i),0==r&&a.setAttribute("Reference","yes"),a.removeAttribute("cx"),a.removeAttribute("cy")}for(n=t.evaluate("//Edge",t,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0;r<n.snapshotLength;r++){var a;l=(a=n.snapshotItem(r)).getAttribute("id"),i="E"+r.toString().padStart(2,0);e[l]="E"+r.toString().padStart(2,0),a.setAttribute("id",i);var o=a.getAttribute("StartNode"),s=a.getAttribute("EndNode"),d=e[o]??"",u=e[s]??"";a.setAttribute("StartNode",d),a.setAttribute("EndNode",u),a.removeAttribute("RunID")}window.navigator.clipboard.writeText(t.documentElement.outerHTML),alert("Pattern was successfully copied to Clipboard")}function KeyPressed(){"Escape"===event.key&&(todo=document.querySelectorAll("svg *"),todo.forEach((t=>unhighlight(t.getAttribute("id")))),document.getElementById("floatingWindow").style.display="none",selectSet=[])}function setupContextMenu(){contextMenu=document.getElementById("contextMenu"),modal=document.getElementById("modal"),propertiesTable=document.getElementById("propertiesTable"),document.addEventListener("click",(()=>{contextMenu.classList.remove("show")}));let t=document.querySelector("#contextMenu ul"),e=document.createElement("li");e.textContent="Isolate Equipment",e.onclick=equipmentIsolationPaths,t.appendChild(e),e=document.createElement("li"),e.textContent="Downstream paths",e.onclick=showDownstreamPaths,t.appendChild(e),e=document.createElement("li"),e.textContent="Upstream paths",e.onclick=showUpstreamPaths,t.appendChild(e),e=document.createElement("li"),e.textContent="Properties",e.onclick=showProperties,t.appendChild(e),e=document.createElement("li"),e.textContent="Copy as pattern",e.onclick=GetPattern,t.appendChild(e);const n=document.getElementById("floatingWindow"),r=document.getElementById("windowHeader"),l=document.getElementById("closeButton");n.style.display="none";let i=0,a=0,o=!1;r.addEventListener("mousedown",(t=>{o=!0,i=t.clientX-n.offsetLeft,a=t.clientY-n.offsetTop,r.style.cursor="grabbing"})),document.addEventListener("mousemove",(t=>{o&&(n.style.left=t.clientX-i+"px",n.style.top=t.clientY-a+"px")})),document.addEventListener("mouseup",(()=>{o=!1,r.style.cursor="grab"})),l.addEventListener("click",(()=>{n.style.display="none"}))}function showDownstreamPaths(){var t=document.getElementById("modal");t.classList.add("active"),setTimeout((()=>{selectedPaths=FindDownstreamPaths(currentElement.id),t.classList.remove("active"),populatePathsTable("Downstream paths")}),250)}function showUpstreamPaths(){var t=document.getElementById("modal");t.classList.add("active"),setTimeout((()=>{selectedPaths=FindUpstreamPaths(currentElement.id),t.classList.remove("active"),populatePathsTable("Upstream paths")}),250)}function equipmentIsolationPaths(){var t=document.getElementById("modal");t.classList.add("active"),setTimeout((()=>{selectedPaths=IsolateEquipment(currentElement.id),t.classList.remove("active"),populatePathsTable("Equipment isolation")}),250)}function showProperties(){document.getElementById("floatingWindow").style.display="block";const t=showMetadata(currentElement.id);document.getElementById("windowTitle").innerHTML="Properties",propertiesTable.innerHTML="",t.forEach((t=>{const e=document.createElement("tr"),n=document.createElement("td"),r=document.createElement("td");n.textContent=t.name,n.style.textAlign="right",r.textContent=t.value,e.appendChild(n),e.appendChild(r),propertiesTable.appendChild(e)}))}function closeModal(){modal.style.display="none"}function unhighlight(t){elmt=document.getElementById(t),elmt?(elmtClass=elmt.className.baseVal+"",elmtClass.includes("_highlighted")&&(elmtClass=elmtClass.substring(0,elmt.classList[0].length-12),elmt.setAttribute("class",elmtClass))):(console.log('Highlight - Element not found for element ID="'+t+'"'),console.clear())}function highlight(t){elmt=document.getElementById(t),elmt?(elmtClass=elmt.className.baseVal+"",elmtClass.includes("_highlighted")||elmt.setAttribute("class",elmtClass+"_highlighted")):(console.log('Highlight - Element not found for element ID="'+t+'"'),console.clear())}function setOpacity(t,e){document.getElementById(t).setAttribute("opacity",e)}function xPathSelect(t){for(var e=xmlDoc.evaluate(t,xmlDoc,null,XPathResult.ANY_TYPE,null),n=e.iterateNext(),r=[],l=0;n;){r[l]=n.attributes[0].nodeValue,l++;n=e.iterateNext()}r.forEach(highlight)}function evaluateCriteria(t,e){var n=xmlDoc.getElementById(t);return itemClass=n.localName,query="//"+itemClass+"[@id='"+t+"']"+e,matches=xmlDoc.evaluate(query,xmlDoc,null,XPathResult.BOOLEAN_TYPE,null),matches.booleanValue}function _findPaths(t,e,n,r,l,i,a=[]){null==i&&(i=defaultPathLengthLimit);var o=a.map((t=>t));if(o.push(t),o.length>i)return lengthExcededCount++,[];if(t===e)return[o];const s=[];var d=xmlDoc.querySelectorAll('Edge[StartNode="'+t+'"], Edge[EndNode="'+t+'"]');for(let a=0;a<d.length;a++)if(evaluateCriteria(d[a].getAttribute("id"),l)){var u="";if(evaluateCriteria(u=n?"StartNode to EndNode"==d[a].getAttribute("FlowDir")||""==d[a].getAttribute("FlowDir")?d[a].getAttribute("EndNode"):d[a].getAttribute("StartNode"):d[a].getAttribute("StartNode")===t?d[a].getAttribute("EndNode"):d[a].getAttribute("StartNode"),r)&&!o.includes(u)){const t=_findPaths(u,e,n,r,l,i,o);for(let e=0;e<t.length;e++)s.push(t[e])}}return s}function FindPaths(t,e,n,r,l,i,a=[]){return result=_findPaths(t,e,n,r,l,i,a).sort(((t,e)=>t.length-e.length)),lengthExcededCount>0&&(console.log("WARNING: "+lengthExcededCount+" search branches where discarded, because prune length ("+i+") was exceeded."),lengthExcededCount=0),result}function _findStreamPaths(t,e,n,r,l,i=[],a=[]){null==(l=defaultPathLengthLimit)&&(l=defaultPathLengthLimit);var o=i.map((t=>t)),s=a.map((t=>t));if(o.push(t),o.length>l)return lengthExcededCount++,[];if(""==e&&!listOfChildNozzles.includes(t)&&evaluateCriteria(t,n))return[o];const d=[];var u=0,c=xmlDoc.querySelectorAll('Edge[StartNode="'+t+'"], Edge[EndNode="'+t+'"]');for(let i=0;i<c.length;i++)if(!s.includes(c[i].getAttribute("id"))&&(s.push(c[i].getAttribute("id")),evaluateCriteria(c[i].getAttribute("id"),r))){var m="";if("Downstream"==e&&(t==c[i].getAttribute("StartNode")&&(m="StartNode to EndNode"==c[i].getAttribute("FlowDir")||""==c[i].getAttribute("FlowDir")?c[i].getAttribute("EndNode"):""),t==c[i].getAttribute("EndNode")&&(m="EndNode to StartNode"==c[i].getAttribute("FlowDir")?c[i].getAttribute("StartNode"):"")),"Upstream"==e&&(t==c[i].getAttribute("StartNode")&&(m="EndNode to StartNode"==c[i].getAttribute("FlowDir")?c[i].getAttribute("EndNode"):""),t==c[i].getAttribute("EndNode")&&(m="StartNode to EndNode"==c[i].getAttribute("FlowDir")||""==c[i].getAttribute("FlowDir")?c[i].getAttribute("StartNode"):"")),""==e&&(m=t==c[i].getAttribute("StartNode")?c[i].getAttribute("EndNode"):c[i].getAttribute("StartNode")),""!=m&&!o.includes(m)){u++;const t=_findStreamPaths(m,e,n,r,l,o,s);for(let e=0;e<t.length;e++)d.push(t[e])}}return 0==u?[o]:d}function FindDownstreamPaths(t){var e=defaultPathLengthLimit;return result=_findStreamPaths(t,"Downstream",downstreamNodeFilter,downstreamEdgeFilter).sort(((t,e)=>t.length-e.length)),result.length>0&&console.log("FindDownstreamPaths : Max path lengh = "+result[result.length-1].length),lengthExcededCount>0&&(console.log("WARNING: "+lengthExcededCount+" search branches where discarded, because prune length ("+e+") was exceeded."),lengthExcededCount=0),result}function FindUpstreamPaths(t){var e=defaultPathLengthLimit;return result=_findStreamPaths(t,"Upstream",upstreamNodeFilter,upwnstreamEdgeFilter).sort(((t,e)=>t.length-e.length)),result.length>0&&console.log("FindUpstreamPaths : Max path lengh = "+result[result.length-1].length),lengthExcededCount>0&&(console.log("WARNING: "+lengthExcededCount+" search branches where discarded, because prune length ("+e+") was exceeded."),lengthExcededCount=0),result.forEach(highlightPath),result}function IsolateEquipment(t){if(itemToIsolate=xmlDoc.getElementById(t),"Equipment"==itemToIsolate.children[0].getAttribute("Type")){listOfChildNozzles="";for(var e=xmlDoc.evaluate("//Node[@id=//Edge[@Type='DirectConnection' and @EndNode='"+t+"']/@StartNode]/@id",xmlDoc,null,XPathResult.ANY_TYPE,null);noz1=e.iterateNext();)listOfChildNozzles+=noz1.value+",";for(var n=xmlDoc.evaluate("//Node[@id=//Edge[@Type='DirectConnection' and @StartNode='"+t+"']/@EndNode]/@id",xmlDoc,null,XPathResult.ANY_TYPE,null);noz2=n.iterateNext();)listOfChildNozzles+=noz2.value+",";isolatedItemId=t;var r=defaultPathLengthLimit;return result=_findStreamPaths(t,"",isolateNodeFilter,isolateEdgeFilter).sort(((t,e)=>t.length-e.length)),result.length>0&&console.log("IsolateEquipment : Max path lengh = "+result[result.length-1].length),lengthExcededCount>0&&(console.log("WARNING: "+lengthExcededCount+" search branches where discarded, because prune length ("+r+") was exceeded."),lengthExcededCount=0),result.forEach(highlightPath),isolatedItemId="",result}}function highlightPath(t=[]){for(t.map(highlight),i=1;i<t.length;i++){highlight(xmlDoc.evaluate("//Edge[(@StartNode='"+t[i-1]+"' and @EndNode='"+t[i]+"') or (@StartNode='"+t[i]+"' and @EndNode='"+t[i-1]+"')]",xmlDoc,null,XPathResult.ANY_TYPE,null).iterateNext().attributes[0].value)}}function copyPathToClipboard(t=[]){var e="[";for(i=0;i<t.length;i++){var n=xmlDoc.getElementById(t[i]),r=n.children[0].getAttribute("ItemTag");null==r&&(r=n.id),e+=r+","}e=e.slice(0,-1),e+="]",window.navigator.clipboard.writeText(e)}function populatePathsTable(t){var e=selectedPaths;propertiesTable.innerHTML="",document.getElementById("windowTitle").innerHTML=t,fwindow=document.getElementById("floatingWindow"),fwindow.style.display="block";var n='<table><tr><td><input type="checkbox" id="path_all" onchange="checkboxChanged(\'path_all\')" checked>&nbsp;'+selectedPaths.length+" paths found</td></tr></table>";Math.ceil(e.length/15);n+="<table><tr valign='top'>";var r=0;e.forEach((t=>{textedPath=t.map((function(t){return"'"+t+"'"})),0==r?n+="<td><table>":r%15==0&&(n+="</table></td><td><table>"),n+='<tr><td><input type="checkbox" id="path_'+r+'" onchange="checkboxChanged(\'path_'+r+"')\" checked></td>",n+='<td><button class="copy-btn" id="cc_'+r+'" onclick="copyPathToClipboard(['+textedPath+']);"><img src="https://jthos.github.io/copy.jpg" alt="Copy path to clipboard" class="icono"></button></td>',n+="<td>Path "+(r+1)+": "+e[r].length+" nodes</td></tr>",highlightPath(t),r++})),n+="</table></td></tr></table>",propertiesTable.innerHTML=n}function checkboxChanged(t){var e=selectedPaths;cb=document.getElementById(t),console.log(cb.checked);var n=0;if("path_all"==t)for(n=0;n<e.length;n++)document.getElementById("path_"+n).checked=cb.checked;for(todo=document.querySelectorAll("svg *"),todo.forEach((t=>unhighlight(t.getAttribute("id")))),n=0;n<e.length;n++)document.getElementById("path_"+n).checked&&highlightPath(e[n])}function findElementsInXML(t){const e=(new DOMParser).parseFromString(xmlDoc,"text/xml"),n=[];return e.querySelectorAll("Node, Edge").forEach((e=>{t.includes(e.getAttribute("id"))&&n.push(e.getAttribute("id"))})),n}